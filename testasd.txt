import cv2
from ultralytics import YOLO
import easyocr

# Inisialisasi OCR
reader = easyocr.Reader(['en', 'id'])

# Load model
model = YOLO('license_plate_detector.pt')

# Baca gambar
img = cv2.imread('image/asdasd.png')

# Deteksi tanpa threshold
results = model(img, conf=0.04)

# Proses deteksi
for result in results:
    boxes = result.boxes
    print(f"Total deteksi: {len(boxes)}")
    
    for i, box in enumerate(boxes):
        x1, y1, x2, y2 = map(int, box.xyxy[0].cpu().numpy())
        conf = float(box.conf[0])
        w, h = x2 - x1, y2 - y1

        # Tampilkan info deteksi
        print(f"[{i+1}] Confidence: {conf:.2f} | Ukuran ROI: {w}x{h}")

        # Batasi OCR hanya untuk deteksi yang cukup besar dan confidence â‰¥ 0.3
        if conf >= 0.3 and w > 20 and h > 20:
            roi = img[y1:y2, x1:x2]

            try:
                ocr_result = reader.readtext(roi)
                if ocr_result:
                    print(f"    OCR: {ocr_result[0][1]}")
                else:
                    print("    OCR: [Tidak terbaca]")
            except Exception as e:
                print(f"    OCR ERROR: {e}")
        else:
            print("    Lewati OCR (confidence terlalu rendah atau ROI terlalu kecil)")
